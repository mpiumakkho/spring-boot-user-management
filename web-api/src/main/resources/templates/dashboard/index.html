<!DOCTYPE html>
<html lang="th" xmlns:th="http://www.thymeleaf.org" th:replace="~{layouts/base :: layout(~{::content}, '')}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <div th:fragment="content">
        <!-- welcome header -->
        <div class="mb-4">
            <h2 class="mb-1">
                <i class="bi bi-grid me-2"></i>Dashboard
            </h2>
            <p class="text-muted mb-0">Welcome to the User Management System</p>
        </div>

        <!-- statistics cards -->
        <div class="row g-4 mb-4">
            <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="100">
                <div class="card shadow h-100" style="border-radius: 15px; border: none; border-left: 4px solid #0d6efd; transition: transform 0.2s;">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-primary text-uppercase mb-2" style="font-size: 0.8rem; letter-spacing: 0.05em;">
                                    Total Users
                                </div>
                                <div class="h2 mb-0 font-weight-bold text-gray-800" th:text="${stats?.totalUsers ?: 0}" style="font-size: 2.5rem;">0</div>
                            </div>
                            <div class="col-auto">
                                <i class="bi bi-people text-primary" style="font-size: 3rem; opacity: 0.8;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="200">
                <div class="card shadow h-100" style="border-radius: 15px; border: none; border-left: 4px solid #198754; transition: transform 0.2s;">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-success text-uppercase mb-2" style="font-size: 0.8rem; letter-spacing: 0.05em;">
                                    Total Roles
                                </div>
                                <div class="h2 mb-0 font-weight-bold text-gray-800" th:text="${stats?.totalRoles ?: 0}" style="font-size: 2.5rem;">0</div>
                            </div>
                            <div class="col-auto">
                                <i class="bi bi-person-badge text-success" style="font-size: 3rem; opacity: 0.8;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="300">
                <div class="card shadow h-100" style="border-radius: 15px; border: none; border-left: 4px solid #0dcaf0; transition: transform 0.2s;">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-info text-uppercase mb-2" style="font-size: 0.8rem; letter-spacing: 0.05em;">
                                    Total Permissions
                                </div>
                                <div class="h2 mb-0 font-weight-bold text-gray-800" th:text="${stats?.totalPermissions ?: 0}" style="font-size: 2.5rem;">0</div>
                            </div>
                            <div class="col-auto">
                                <i class="bi bi-key text-info" style="font-size: 3rem; opacity: 0.8;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-xl-3 col-md-6" data-aos="fade-up" data-aos-delay="400">
                <div class="card shadow h-100" style="border-radius: 15px; border: none; border-left: 4px solid #ffc107; transition: transform 0.2s;">
                    <div class="card-body">
                        <div class="row no-gutters align-items-center">
                            <div class="col mr-2">
                                <div class="text-xs font-weight-bold text-warning text-uppercase mb-2" style="font-size: 0.8rem; letter-spacing: 0.05em;">
                                    Core API Status
                                </div>
                                <div class="h5 mb-0 font-weight-bold text-gray-800">
                                    <span class="badge" style="background-color: rgba(25, 135, 84, 0.1); color: #198754; font-weight: 500; padding: 0.5rem 1rem; border-radius: 8px;">
                                        <i class="bi bi-check-circle me-1"></i>Online
                                    </span>
                                </div>
                            </div>
                            <div class="col-auto">
                                <i class="bi bi-server text-warning" style="font-size: 3rem; opacity: 0.8;"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- main content -->
        <div class="row g-4">
            <!-- quick actions -->
            <div class="col-lg-8" data-aos="fade-right" data-aos-delay="500">
                <div class="card shadow" style="border-radius: 15px; border: none;">
                    <div class="card-header py-3" style="background: linear-gradient(to right, #f8f9fa, #ffffff); border-radius: 15px 15px 0 0; border: none;">
                        <h6 class="m-0 font-weight-bold text-primary" style="font-size: 1.1rem;">
                            <i class="bi bi-lightning-charge me-2"></i>Quick Actions
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="d-grid">
                                    <a th:href="@{/users/create}" class="btn btn-primary btn-lg" 
                                       style="border-radius: 10px; font-weight: 500; transition: transform 0.2s;">
                                        <i class="bi bi-person-plus-fill me-2"></i>
                                        Add New User
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-grid">
                                    <a th:href="@{/roles/create}" class="btn btn-success btn-lg" 
                                       style="border-radius: 10px; font-weight: 500; transition: transform 0.2s;">
                                        <i class="bi bi-plus-circle-fill me-2"></i>
                                        Create Role
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-grid">
                                    <a th:href="@{/permissions/create}" class="btn btn-info btn-lg text-white" 
                                       style="border-radius: 10px; font-weight: 500; transition: transform 0.2s;">
                                        <i class="bi bi-key-fill me-2"></i>
                                        Add Permission
                                    </a>
                                </div>
                            </div>
                        </div>

                        <hr class="my-4" style="opacity: 0.1;">

                        <div class="row g-3">
                            <div class="col-md-4">
                                <div class="d-grid">
                                    <a th:href="@{/users}" class="btn btn-outline-primary" 
                                       style="border-radius: 10px; font-weight: 500; transition: transform 0.2s; border-width: 2px;">
                                        <i class="bi bi-people me-2"></i>
                                        Manage Users
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-grid">
                                    <a th:href="@{/roles}" class="btn btn-outline-success" 
                                       style="border-radius: 10px; font-weight: 500; transition: transform 0.2s; border-width: 2px;">
                                        <i class="bi bi-person-badge me-2"></i>
                                        Manage Roles
                                    </a>
                                </div>
                            </div>
                            <div class="col-md-4">
                                <div class="d-grid">
                                    <a th:href="@{/permissions}" class="btn btn-outline-info" 
                                       style="border-radius: 10px; font-weight: 500; transition: transform 0.2s; border-width: 2px;">
                                        <i class="bi bi-key me-2"></i>
                                        Manage Permissions
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- system info -->
            <div class="col-lg-4" data-aos="fade-left" data-aos-delay="600">
                <div class="card shadow" style="border-radius: 15px; border: none;">
                    <div class="card-header py-3" style="background: linear-gradient(to right, #f8f9fa, #ffffff); border-radius: 15px 15px 0 0; border: none;">
                        <h6 class="m-0 font-weight-bold text-primary" style="font-size: 1.1rem;">
                            <i class="bi bi-info-circle me-2"></i>System Information
                        </h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-4">
                            <small class="text-muted" style="font-size: 0.85rem;">Core API URL</small>
                            <div class="text-break">
                                <code th:text="${coreApiUrl}" 
                                      style="background-color: rgba(13, 110, 253, 0.1); color: #0d6efd; padding: 0.4rem 0.8rem; border-radius: 8px; font-size: 0.9rem;">
                                    http://localhost:8091
                                </code>
                            </div>
                        </div>
                        
                        <div class="mb-4">
                            <small class="text-muted" style="font-size: 0.85rem;">Web API Version</small>
                            <div class="badge bg-success" style="font-size: 0.9rem; padding: 0.5rem 1rem; border-radius: 8px;">v1.0.0</div>
                        </div>
                        
                        <div class="mb-4">
                            <small class="text-muted" style="font-size: 0.85rem;">Last Updated</small>
                            <div class="badge bg-secondary" style="font-size: 0.9rem; padding: 0.5rem 1rem; border-radius: 8px;"
                                 th:text="${#dates.format(#dates.createNow(), 'dd/MM/yyyy HH:mm')}">
                                Current time
                            </div>
                        </div>

                        <div class="text-center">
                            <button class="btn btn-light" onclick="window.location.reload()" 
                                    style="border-radius: 8px; transition: transform 0.2s;">
                                <i class="bi bi-arrow-clockwise me-1"></i>Refresh Dashboard
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- error display -->
        <div th:if="${error}" class="row mt-4">
            <div class="col-12">
                <div class="card shadow" style="border-radius: 15px; border: none; border-left: 4px solid #dc3545;">
                    <div class="card-header py-3" style="background-color: rgba(220, 53, 69, 0.1); border-radius: 15px 15px 0 0; border: none;">
                        <h6 class="m-0 text-danger" style="font-size: 1.1rem;">
                            <i class="bi bi-exclamation-triangle me-2"></i>Connection Error
                        </h6>
                    </div>
                    <div class="card-body">
                        <p class="mb-2 text-danger" th:text="${error}">Error message will appear here</p>
                        <small class="text-muted">
                            Please check if the Core API is running on 
                            <code th:text="${coreApiUrl}" 
                                  style="background-color: rgba(220, 53, 69, 0.1); color: #dc3545; padding: 0.2rem 0.4rem; border-radius: 4px;">
                                Core API URL
                            </code>
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <th:block th:fragment="extra-scripts">
        <script>
            // Initialize AOS (Animate On Scroll)
            document.addEventListener('DOMContentLoaded', function() {
                AOS.init({
                    duration: 800,
                    easing: 'ease-in-out',
                    once: true,
                    offset: 100
                });
            });

            // Add hover effect to cards
            document.querySelectorAll('.card').forEach(card => {
                card.addEventListener('mouseenter', () => {
                    if (card.style.transition) {
                        card.style.transform = 'translateY(-5px)';
                    }
                });
                card.addEventListener('mouseleave', () => {
                    if (card.style.transition) {
                        card.style.transform = 'translateY(0)';
                    }
                });
            });

            // Add hover effect to buttons
            document.querySelectorAll('.btn').forEach(btn => {
                btn.addEventListener('mouseenter', () => {
                    if (btn.style.transition) {
                        btn.style.transform = 'translateY(-2px)';
                    }
                });
                btn.addEventListener('mouseleave', () => {
                    if (btn.style.transition) {
                        btn.style.transform = 'translateY(0)';
                    }
                });
            });

            // Enhanced loading states
            document.querySelectorAll('a[href*="/create"], a[href*="/edit"]').forEach(link => {
                link.addEventListener('click', function(e) {
                    const originalText = this.innerHTML;
                    this.innerHTML = '<i class="bi bi-hourglass-split me-2"></i>Loading...';
                    this.style.pointerEvents = 'none';
                    
                    // Reset after 2 seconds if page doesn't change
                    setTimeout(() => {
                        this.innerHTML = originalText;
                        this.style.pointerEvents = 'auto';
                    }, 2000);
                });
            });
        </script>
    </th:block>
</body>
</html> 